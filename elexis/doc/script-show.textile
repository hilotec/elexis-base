h1. Elexis Scripts

{toc}

h2. Was ist das?

Scripts sind die "Apps" von Elexis: Schnell gebaute, leicht installier- und löschbare Helferlein für eng umrissene 
Aufgaben. Scripts können auf verschiedene Arten benutzt werden:
* Als Filter in manchen Listen, z.B. der Patientenliste. Ein solches Script durchsucht alle Elemente der Liste
auf beliebige Merkmale, die es dann anzeigen, summieren oder sonstwie verarbeiten kann.
* Als Formel um einen Befund oder Laborwert zu errechnen.
* Als Teil eines Platzhalters in einer Textvorlage.
* Als selbständig ablaufendes Unterprogramm in Elexis

Alle Scripts werden in der View  "Script" erstellt und gesammelt und können auch von dort gestartet werden. Ein Script von einem System in ein anderes zu kopieren, ist einfach eine Sache von cut&paste. Eine Einführung in die Syntax ist "hier":http://www.elexis.ch/jp/content/view/218/45/

Hier soll eine Sammlung von nützlichen Scripts entstehen, die alle zur beliebigen Benutzung freigegeben sind. Wenn Sie auch ein Script entwickelt haben, senden Sie es bitte!


h2. Scriptparade

h3. Hausarztmodell anzeigen

/*
 Name:  	Hausarztmodell
 Zweck:  Gibt einen Text zurück, wenn der aktuelle Patient im Hausarztmodell ist
 Kontext:  Briefvorlagen
 Elexis:  2.1ff
*/

bc. import java.util.List;
import ch.elexis.data.*;
List stickers=actPatient.getStickers();
for(int i=0;i<stickers.size();i++){
	sticker=stickers.get(i);
	if(sticker.getLabel().equals("Hausarztmodell")){
		return "(Patient ist im Hausarztmodell versichert; bitte vor Weiterabklärungen Rücksprache nehmen)";
	}
}
return ""; // Nicht im Hausarztmodell, nichts schreiben.

h3. Kopie an Hausarzt

/*
 Name: KopieAnHA
 Zweck:  Erzeugt eine Zeile "Kopie an: ", sofern ein Hausarzt oder Zuweiser erfasst is
 Kontext: Briefvorlagen
 Elexis:  2.1ff
*/

bc. import ch.elexis.data.*;
import java.util.List;

bc. List bezugskontakte=actPatient.getBezugsKontakte();
if(bezugskontakte.size()>0){
	for(int i=0;i<bezugskontakte.size();i++){
 		bz=bezugskontakte.get(i);
 		bezug=bz.getBezug();
 		if(bezug.equals("Hausarzt") || bezug.equals("Zuweiser")){
 			ha=bz.getBezugsKontakt();
 			return "Kopie: "+ha.getPostAnschrift(false);
 		}
 	}
}
return ""; // Wenn kein Bezugskontakt gefunden wurde, Kopie-Zeile leer lassen.

h3. Stammdatenexport

/* Name:  Stammdatenexport
    Zweck: Exportiert Stammdaten in eine CSV-Datei 
    Kontext: Direkt
    Voraussetzung: Elexis 1.4ff

 Exportiert Daten aller Patienten, die seit "startDatum" eine Konsultation hatten, oder sämtlicher 
 Patienten, falls startDatum null ist.
*/

bc. import ch.elexis.scripting.*;
startDatum="01.01.2002";
new Stammdatenexport().doExport(startDatum);
